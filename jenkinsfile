pipeline {
    agent any
	parameters {
	choice(
		name: 'TASKS',
		choices: ['smoke_tests', 'regression_tests', 'ui_tests', 'api_tests', 'test'],
		description: 'Выбор тестового прогона'
		)
	}
    stages {
        stage('Clean') {
          steps {
            sh 'chmod +x gradlew'
            sh './gradlew clean'
          }
        }
        stage('Test') {
          steps {
			script {
			try {
				sh './gradlew ${TASKS} --no-daemon --warning-mode=all'
			}
			catch (Exception e) {
				println("Error ${e}")
			}
          }
		  }
        }
        stage('Allure Report') {
          steps {
            allure([
            includeProperties: false,
            jdk: '',
            properties: [],
            reportBuildPolicy: 'ALWAYS',
            results: [[path: 'build/allure-results']]
            ])
          }
        }
		stage('Email') {
            steps {
             sh "java  \
                "-Dmessenger=email" +
                "-Dmail.host=smtp.gmail.com" +
                "-Dmail.port=465" +
                "-Dmail.username=grave1kro@gmail.com" +
                "-Dmail.password=12345..." +
                "-Dmail.to=innokentiy@ajgi.ru" +
                "-Dproject.name=${JOB_BASE_NAME}" +
                "-Dbuild.launch.name=Some release 2.0" +
                "-Dbuild.env=https://prod.your.site" +
                "-Dbuild.report.link=${BUILD_URL}" +
                "-Dlang=en" +
                "-Denable.chart=true" +
                "-Dallure.report.folder=./allure-report/" +
                "-jar allure-notifications-2.2.1.jar"
            }
        }
    }
}